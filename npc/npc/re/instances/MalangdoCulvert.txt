//===== Hercules Script ======================================
//= Malangdo Culvert
//===== By: =========Translation:============================= 
//= Euphy            °²ºÕ¶û|20130701[ROSF.US]
//===== Current Version: =====================================
//= 1.1
//===== Description: =========================================
//= [Official Conversion]
//= Clean the culverts and defeat the Coelacanth.
//= Daily and weekly quests are available.
//= Contains a normal mode and hard mode.
//===== Additional Comments: =================================
//= 1.0 First version. [Euphy]
//=     Letters "n" and "h" in NPC names indicate difficulty.
//= 1.0a There is no minimum party size on official servers.
//= 1.0b Fixed incorrect use of 'close'. [Joseph]
//= 1.1 Instance system rewrite. [Euphy]
//============================================================

1@pump	mapflag	src4instance
2@pump	mapflag	src4instance
//============================================================

// Quest NPCs
//============================================================
mal_in01,172,28,2	script	°¢¶û²©#mal	561,{
	if (checkweight(1201,1) == 0) {
		mes "ÄãĞ¯´øÁËÌ«¶àÖÖÀàµÄÎïÆ·.³¢ÊÔ¼õÉÙÎïÆ·ÖÖÀàÈ»ºó¼ÌĞø.";
		close;
	}
	if (MaxWeight - Weight < 1000) {
		mes "ÄãµÄ¸ºÖØ²»¹»ÁË.³¢ÊÔ½µµÍ¸ºÖØÈ»ºó¼ÌĞø.";
		close;
	}
	if (BaseLevel < 90) {
		mes "[°¢¶û¶à]";
		mes "ÄãÊÇË­?";
		mes "ÎÒÃÇ²»ĞèÒªÈõÕß!!";
		close;
	}
	setarray .@quests[0],12271,12272,12273,12274;
	setarray .@names$[0],
		"ÆÕÍ¨ÅÅË®ÇşÈÕ³£ÈÎÎñ","^990000À§ÄÑÅÅË®ÇşÈÕ³£ÈÎÎñ^000000",
		"ÆÕÍ¨ÅÅË®ÇşÖÜÈÎÎñ","^990000À§ÄÑÅÅË®ÇşÖÜÈÎÎñ^000000";
	set .@menu$,"Ïë²»Ïë½ÓÊÜÕâ¸ö¹¤×÷?:";
	for(set .@i,0; .@i<4; set .@i,.@i+1) {
		if (checkquest(.@quests[.@i],PLAYTIME) > -1) {
			set .@status[.@i],2;
			set .@menu$, .@menu$+"^aaaaaa- Ã»ÓĞĞÂµÄÈÎÎñ -^000000:";
		} else if (.@i%2 && BaseLevel < 140) {
			set .@status[.@i],0;
			set .@menu$, .@menu$+"^aaaaaaÄã²»ÄÜ½ÓÕâ¸öÈÎÎñ,ÒòÎªÄã¼¶±ğ²»¹»^000000:";
		} else {
			set .@status[.@i],1;
			set .@menu$, .@menu$+.@names$[.@i]+":";
		}
	}
	mes "[°¢¶û²©]";
	mes "ÎÒÃÇ´©Ô½ÁËº£Ñó! ÎÒÃÇÎ°´óµÄÓ¢ĞÛ!";
	mes "¾ø²»Ô­ÁÂ! ²»ÄÜÔ­ÁÂÄÇĞ©¸ÃËÀµÄº£ÑóÉúÎï!";
	next;
	set .@i, select(.@menu$)-1;
	if (.@i == 0) {
		mes "[°¢¶û²©]";
		mes "ÎÒÃÇÔøÊÇÏÈÉúµÄĞÄ¸¹ÊÖÏÂ. ÏÈÉúÊÇÒ»Î»ÄÜ¹»´´ÔìÀúÊ·µÄÈËÎï. Èç¹ûËûÍê³ÉÁË×Ô¼ºµÄÃÎÏë. ÄÇÎÒÃÇÒ²ÄÜ¹»³ÉÎªÄÜ¹»¼ûÖ¤ÀúÊ·µÄ·Ç·²ÈËÎïÁË.";
		next;
		mes "[°¢¶û²©]";
		mes "µ«ÊÇ,º£Ë®ºÍº£ÑóÉúÎïÑÍÃ»ÁËÒ»ÇĞ. ÏÈÉúËùÓĞÕä¹óµÄ×ÊÁÏÈ«²¿±»º£Ë®ºÍº£ÑóÉúÎïÍÌÊÉÁË. ÎÒÃÇµÄÃÎÏë... ÃÎÏë... ";
		next;
		mes "[°¢¶û²©]";
		mes "ËùÒÔ¾ø¶Ô²»¿ÉÔ­ÁÂÄÇĞ©º£ÑóÉúÎï!!! ÎÒÒ»¶¨Òª°ÑËüÃÇ×ö³Éº£ÏÊÉ«À­,È»ºóÓÃÀ±½·ºıÔÚÒ»Æğ³Ôµô.";
		next;
		mes "^0000ff°¢¶û²©µÄÉùÒôÒòÎª·ßÅ­¶ø²ü¶¶,µ±ËûËµµ½À±½·ºıÔÚÒ»Æğ³ÔµôµÄÊ±ºò, ²»Ğ¡ĞÄÔÒµ½ÁË×Ô¼ºµÄ×ì´½.^000000";
		close;
	}
	switch(.@status[.@i-1]) {
	case 0:
		mes "[°¢¶û²©]";
		mes "ÕâÏîÈÎÎñ¶ÔÄãÀ´ËµºÜÄÑ.ÎÒ²»ÄÜ¸æËßÄãÎªÊ²Ã´.Äã¿¼ÂÇÏÂ½ÓÕÒÁíÒ»¸ö°É?";
		close;
	case 1:
		break;
	case 2:
		mes "[°¢¶û²©]";
		mes "¶Ô²»Æğ,ÓĞÃ»ÓĞĞÂµÄÈÎÎñ!Èç¹ûÎÒÓĞĞèÒª×öµÄ,ÎÒ»á¸æËßÄãµÄ!";
		close;
	}
	switch(.@i) {
	case 1: // General Culvert Daily Service
		switch(rand(1,6)) {
			case 1: callsub L_GiveQuest,.@i,12255,12271,"Éîº£Ğ·";
			case 2: callsub L_GiveQuest,.@i,12256,12271,"Éîº£ÕÂÓã";
			case 3: callsub L_GiveQuest,.@i,12257,12271,"Éîº£ó¦Ğ·";
			case 4: callsub L_GiveQuest,.@i,12258,12271,"Éîº£¼Ä¾ÓĞ·";
			case 5: callsub L_GiveQuest,.@i,12259,12271,"Éîº?â¿ËÀ×";
			case 6: callsub L_GiveQuest,.@i,12260,12271,"Éîº£Ğ·Öë";
		}
	case 2: // Hard Culvert Daily Service
		switch(rand(1,6)) {
			case 1: callsub L_GiveQuest,.@i,12261,12272,"Éîº£º£Âí";
			case 2: callsub L_GiveQuest,.@i,12262,12272,"Éîº£½£Óã";
			case 3: callsub L_GiveQuest,.@i,12263,12272,"º£Éñ";
			case 4: callsub L_GiveQuest,.@i,12264,12272,"Éîº£öùÓã";
			case 5: callsub L_GiveQuest,.@i,12265,12272,"Éîº£ÈËÓã";
			case 6: callsub L_GiveQuest,.@i,12266,12272,"Éîº?¨·¨";
		}
	case 3: // General Culvert Weekly Service
		switch(rand(1,2)) {
			case 1: callsub L_GiveQuest,.@i,12267,12273,"¹ÖÒìÇ»¼¬Óã";
			case 2: callsub L_GiveQuest,.@i,12268,12273,"ºÚ°µÇ»¼¬Óã";
		}
	case 4: // Hard Culvert Weekly Service
		switch(rand(1,2)) {
			case 1: callsub L_GiveQuest,.@i,12269,12274,"Ğ×±©Ç»¼¬Óã";
			case 2: callsub L_GiveQuest,.@i,12270,12274,"Í»±äÇ»¼¬Óã";
		}
	default:
		mes "[°¢¶û²©]";
		mes "ßÀ!? ÄÄÀïµÄÈÎÎñ? ÈÃÎÒ²é²é. Äã×îºÃÎÊÏÂÂíµÂ¿¨.";
		close;
	}
	end;

// callsub L_GiveQuest,.@i,<quest 1>,<quest 2>,<monster>;
L_GiveQuest:
	setquest getarg(1);
	setquest getarg(2);
	mes "[°¢¶û²©]";
	mes "½ñÌìµÄÉîº£Ó¢ĞÛ!";
	mes "ÈÃÎÒÃÇ´óÉùËµ³öËüÃÇÃğ¾øµÄÈÕ×Ó ^0000ff"+getarg(3)+"^000000!";
	next;
	mes "[°¢¶û²©]";
	switch(getarg(0)) {
	case 1:
	case 2:
		mes "À´°É,»ï¼Æ! ²»ÓÃµ£ĞÄ,·ÅÊÖÈ¥×ö°É! ÕâÊÇÒ»¸öÈÕ³£ÈÎÎñ!";
		break;
	case 3:
		mes "ÎÒ¸øÄã1ÖÜÊ±¼äÀ´Íê³ÉÕâ¸öÈÎÎñ,ÔÚ¸±±¾Àï°ÑËüÃÇÈ«²¿É±ËÀ!(ÆÕÍ¨Ä£Ê½)";
		break;
	case 4:
		mes "ÎÒ¸øÄã1ÖÜÊ±¼äÀ´Íê³ÉÕâ¸öÈÎÎñ,ÔÚ¸±±¾Àï°ÑËüÃÇÈ«²¿É±ËÀ!(À§ÄÑÄ£Ê½)";
		break;
	}
	next;
	mes "¸øÄãµÄĞèÇóÊÇ»÷É± ^005500"+getarg(3)+"^000000. Èç¹ûÄúĞèÒªÁË½â¸ü¶àÏêÇé,ÇëÔÚÈÎÎñ´°¿Ú²éÑ¯.";
	close;
}

mal_in01,172,26,2	script	ÂíµÂ¿¨#mal	544,{
	if (checkweight(1201,1) == 0) {
		mes "ÄãĞ¯´øÁËÌ«¶àÖÖÀàµÄÎïÆ·.³¢ÊÔ¼õÉÙÎïÆ·ÖÖÀàÈ»ºó¼ÌĞø.";
		close;
	}
	if (MaxWeight - Weight < 1000) {
		mes "ÄãµÄ¸ºÖØ²»¹»ÁË.³¢ÊÔ½µµÍ¸ºÖØÈ»ºó¼ÌĞø.";
		close;
	}
	if (BaseLevel < 90) {
		mes "[ÂíµÂ¿¨]";
		mes "Karrrrrrr!!";
		mes "ÈÃÎÒÃÇ¸ãÒ»Ğ©¸ÃËÀµÄº£ÑóÉúÎïÀ´ÉÕ¿¾!";
		next;
		mes "[ÂíµÂ¿¨]";
		mes "ÄãÊÇË­? ÄãÕâÑùµÄÈËÁ¬º£Ôå¶¼¿ÉÒÔ¸ÉµôÄã!";
		close;
	}
	mes "[ÂíµÂ¿¨]";
	mes "àŞ?";
	mes "Äã½ÓÊÜÁËÎÒ´ó¸ç°¢¶û²©µÄÈÎÎñ. Õâ¿ÉÊÇ¸ö¿à²îÊÂ!";
	next;
	set .@i, select("- ÄãÔÚÕâÀï×öÊ²Ã´?:- ÈÕ³£ÆÕÍ¨Ä£Ê½ÈÎÎñ½±Àø:- ÈÕ³£À§ÄÑÄ£Ê½ÈÎÎñ½±Àø:- ÖÜ³£ÆÕÍ¨Ä£Ê½ÈÎÎñ½±Àø:- ÖÜ³£À§ÄÑÄ£Ê½ÈÎÎñ½±Àø")-1;
	if (.@i == 0) {
		mes "[ÂíµÂ¿¨]";
		mes "ÎÒÔÚÕâÀïĞ­ÖúÎÒ´ó¸ç°¢¶û²©!";
		next;
		mes "[ÂíµÂ¿¨]";
		mes "Ë­ÄÜ°ÑÕâĞ©°¹ÔàµÄº£ÑóÉúÎïÇåÀí³öº£µ×,ÎÒÃÇ¾Í»á½±Àø¸øËû±¦¹óµÄ²Æ¸»!";
		next;
		mes "[ÂíµÂ¿¨]";
		mes "ÎÒÃÇÌá¹©AºÍB¼¶Ó²±Ò×÷ÎªÈÕ³£ÈÎÎñµÄ½±Àø,ÖÜÈÎÎñ½±ÀøÊÇ×î×î±¦¹óµÄº£ÉñÖ®Å­.";
		next;
		mes "[ÂíµÂ¿¨]";
		mes "Èç¹ûÄã½ÓÊÜÁËÎÒ´ó¸ç°¢¶û²©µÄÈÎÎñ,ÎÒ»á·Ç³£ÀÖÒâ¼ûµ½Äã.ËùÒÔ,ÈÃÎÒÃÇÕ¾µÄ¿¿½üµã!";
		close;
	}
	mes "[ÂíµÂ¿¨]";
	mes "ÎÒ¿É²»»á¸ø¹ıÆÚÈÎÎñ·¢·Å½±Àø,ËùÒÔÏÈÈÃÎÒ¼ì²éÒ»ÏÂ.";
	next;
	specialeffect2 EF_SPHERE;
	progressbar "0xFFFF00",3;
	specialeffect2 EF_STEAL;
	switch(.@i) {
	case 1: // General Culvert Daily Service
		if (checkquest(12271,PLAYTIME) == 2)
			callsub L_EraseQuest,12255,12256,12257,12258,12259,12260,12271;
		else {
			// Reward: 2x B Grade Coin
			callsub L_CheckQuest,12255,"Éîº£Ğ·",6419,2;
			callsub L_CheckQuest,12256,"Éîº£ÕÂÓã",6419,2;
			callsub L_CheckQuest,12257,"Éîº£ó¦Ğ·",6419,2;
			callsub L_CheckQuest,12258,"Éîº£¼Ä¾ÓĞ·",6419,2;
			callsub L_CheckQuest,12259,"Éîº?â¿ËÀ×",6419,2;
			callsub L_CheckQuest,12260,"Éîº£Ğ·Öë",6419,2;
		}
		break;
	case 2: // Hard Culvert Daily Service
		if (checkquest(12272,PLAYTIME) == 2)
			callsub L_EraseQuest,12261,12262,12263,12264,12265,12266,12272;
		else {
			// Reward: 1x A Grade Coin
			callsub L_CheckQuest,12261,"Éîº£º£Âí",6418,1;
			callsub L_CheckQuest,12262,"Éîº£½£Óã",6418,1;
			callsub L_CheckQuest,12263,"º£Éñ",6418,1;
			callsub L_CheckQuest,12264,"Éîº£öùÓã",6418,1;
			callsub L_CheckQuest,12265,"Éîº£ÈËÓã",6418,1;
			callsub L_CheckQuest,12266,"Éîº?¨·¨",6418,1;
		}
		break;
	case 3: // General Culvert Weekly Service
		if (checkquest(12273,PLAYTIME) == 2)
			callsub L_EraseQuest,12267,12268,12273;
		else {
			// Reward: 1x Sea God's Wrath
			callsub L_CheckQuest,12267,"¹ÖÒìÇ»¼¬Óã",6423,1;
			callsub L_CheckQuest,12268,"ºÚ°µÇ»¼¬Óã",6423,1;
		}
		break;
	case 4: // Hard Culvert Weekly Service
		if (checkquest(12274,PLAYTIME) == 2)
			callsub L_EraseQuest,12269,12270,12274;
		else {
			// Reward: 5x Sea God's Wrath
			callsub L_CheckQuest,12269,"Ğ×±©Ç»¼¬Óã",6423,5;
			callsub L_CheckQuest,12270,"Í»±äÇ»¼¬Óã",6423,5;
		}
		break;
	default:
		mes "[ÂíµÂ¿¨]";
		mes "ÓĞĞ©´íÎó. ÇëÔÙ¼ì²éÒ»ÏÂ!";
		close;
	}
	mes "[ÂíµÂ¿¨]";
	mes "ÎÒÃ»¿´µ½ÓĞÈÎºÎÒ»¸öÈÎÎñÒÑ¾­Íê³É!";
	close;

L_EraseQuest:
	for(set .@j,0; .@j<getargcount(); set .@j,.@j+1) {
		if (checkquest(getarg(.@j)) > -1)
			erasequest getarg(.@j);
	}
	mes "[ÂíµÂ¿¨]";
	mes "àÅ,ÎÒºÜ±§Ç¸. ³¬¹ı±ê×¼µÄÈÎÎñÆÚÏŞ, ËùÒÔÎÒ²»ÄÜ¸øÄãÈÎºÎ½±Àø.";
	close;

// callsub L_CheckQuest,<quest ID>,<monster>,<reward item ID>,<reward item amount>;
L_CheckQuest:
	if (checkquest(getarg(0),HUNTING) == 2) {
		mes "[ÂíµÂ¿¨]";
		mes "Äã³Í·£ÁË ^0000ff"+getarg(1)+"^000000!";
		mes "ÕâÊÇÄãµÄ½±Àø!";
		erasequest getarg(0);
		specialeffect2 EF_STEAL;
		getitem getarg(2),getarg(3);
		close;
	}
	return;
}

// Instance Creation
//============================================================
mal_in01,160,34,4	script	Çå½à¹¤Ğ¡ÁÖ	545,{
	if (BaseLevel < 90) {
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÄãÔÚºÍÎÒËµ»°Ã´?!";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÎÒ²»ÖªµÀÄãÀ´µ½ÕâÀïÊÇÊ²Ã´Ô­Òò,µ«Äã²»ÄÜ½øÈë!";
		mes "ÍĞÂíË¹µÄÃüÁî...";
		next;
		mes "^770099ÄãµÄ»ù±¾µÈ¼¶ÖÁÉÙÒª90¼¶ÒÔÉÏ²Å¿ÉÒÔ½øÈ¥.^000000";
		close;
	}
	if (in_canal_n == 0) {
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "(·¢¶¶)";
		next;
		mes "^660066ÕâÃ¨¿´ÆğÀ´Ïñ×´Ì¬²»ºÃ,ËüÎ¢Î¢²ü¶¶.^000000";
		next;
		if(select("²¶×½ÕâÖ»Ã¨:Äã»¹ºÃÂğ?") == 1) {
			mes "[Çå½à¹¤Ğ¡ÁÖ]";
			mes "ÄãÔÚºÍÎÒËµ»°Ã´?!";
			next;
			mes "^660066²ü¶¶µÄÃ¨Ì§Í·¿´×ÅÄã.^000000";
			close;
		}
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "´òÅçÌç!";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÔÚÇåÀíº£µ×Õâ¼şÊÂÇéÉÏ";
		mes "ÎÒÃÇÔø¾­²úÉúÁËºÜ¶àÎÊÌâ.";
		mes "µ«ÊÇ×÷ÎªÒ»Ö»Ã¨±ØĞëÕâÑù×ö...";
		next;
		select("Ê²Ã´º£µ×ÇåÀí?");
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "¶ÔÒ»¸öÍâÀ´ÕßÀ´Ëµ,ÕâÓ¦¸ÃºÜÄ°Éú";
		mes "µ«Êµ¼ÊÉÏÕâ¸öµØ·½";
		mes "´æ·ÅÁËºÜ¶à¼ÍÄîÆ·ºÍÕä¹óµÄ²Æ¸».";
		mes "ÕâÒ²ĞíÄãºÜÄÑÀí½â.";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÔÚÒ»´Î´óµØÕğºó";
		mes "ÎÒÃÇµÄÎï×Ê±»´óË®³å×ß";
		mes "ËäÈ»ÎÒÔø¾­ÊÇÒ»Ãû¾­ÀíÈË";
		mes "µ«ÏÖÔÚÎÒÈ´ÔÚ×öÇå½à¹¤µÄÊÂÇé";
		mes "ÏÖÊµ¾ÍÊÇÈç´ËµÄ²Ğ¿á.";
		next;
		mes "^660066¿´ÉÏÈ¥ÄÇÖ»Ã¨¿ªÊ¼¿ŞÁË...^000000";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÑØ×ÅÕâÑùµÄµØÏÂÊÒÓĞÒ»¸ö¶´Ñ¨.";
		mes "ÄÇÀïÓĞĞí¶à»µÈË,ÉËº¦ÎÒµÄÈË";
		mes "ºÍËüÃÇÕ½¶·ÁËºÜ¶à´Î";
		mes "¶øÇÒÃ¿ÌìºÍÕ½¶·ËüÃÇÕ½¶·ÈÃ";
		mes "ÎÒ·Ç³£Æ£¾ë!";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "Ohh! ÄãÅöµ½ÎÒµÄÍ··¢ÁË!";
		mes "ÎÒµÄ·¢ÖÊÊÇÏÂ½µÁË...ÕâÒ»ÇĞ¶¼";
		mes "ÕâĞ©¼Ò»ïµÄ´í~";
		next;
		mes "^660066Äã²ÅÁôÒâµ½,ÕâÖ»Ã¨µÄÒ»Ğ©Æ¤Ã«¿ªÊ¼ÍÑÂäÁË.^000000";
		next;
		select("ÄãÎªÊ²Ã´²»Àë¿ª!");
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÎÒÒ²ĞèÒªÄ±ÉúµÄ,ÄãËµ¶ÔÃ´?";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÓĞÊ±ºòÎÒµÃµ½Ğ©ĞÒÔËÏä×Ó,";
		mes "ÉõÖÁ¸üºÃµÄÊÇ,ÎÒÄÜµÃĞ©Ê³Îï¹ŞÍ·...";
		next;
		if(select("ºÃ°É,¸É±­!:Èç¹û¿ÉÄÜµÄ»°, ÎÒ»á°ïÄã...") == 1) {
			mes "[Çå½à¹¤Ğ¡ÁÖ]";
			mes "Ğ»Ğ».ÎÒÒª»ØÈ¥³éË®ÁË!";
			close;
		}
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "(Ñ¹µÍËüµÄÉùÒô)";
		mes "Èç¹ûÄãÕæÏë°ïÃ¦,¾Í¿¿ÎÒ½üµã!";
		next;
		select("(¿¿½üºó)");
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "²»ÊÇÃ¿¸öÈË¶¼¿ÉÒÔÔÚÕâÀïµ±°ïÊÖ.";
		mes "ÄÇÒ»¿Ì";
		mes "ÎÒ²»ÄÜ°ïÈÎºÎÈË×öÑ¡Ôñ...";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "Èç¹ûÄãÒª´ÓÕâÀïÏÂÈ¥µÄ»°,ÄÃ×ÅÕâ¸ö°µºÅ.";
		next;
		mes "^660066ÕâÃ¨¸øÁËÄãÒ»ÕÅĞ´×Å°µºÅµÄ±ãÌõ^000000";
		next;
		select("´ò¿ª±ãÌõ.");
		mes "^660000Ò»»á´óÉùµÄ¶ÔÎÒËµ'Äã¾¹¸ÒÎêÈèÎÒ'.^000000";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÄãÔÚÕâÀïĞèÒªÅóÓÑ";
		mes "ÄãºÜÄÑÒ»¸öÈËÃæÁÙÌôÕ½";
		mes "Õâ¸öÖ½Ìõ¿ÉÒÔÈÃÄã³ÉÎª¶Ó³¤!";
		mes "ËùÒÔ×éÖ¯Ò»Ö§¶ÓÎé°É!";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "»¹ÓĞÒ»¸öÖØµãÊÇ";
		mes "ÄãºÍÄãµÄ¶ÓÓÑÃÇ±ØĞëÃ¿´Î´øÀ´Ò»¸öº£ÉñµÄ»¤Éí·û.";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "²»ÒªÍü¼Ç! ";
		mes "Èç¹ûÃ»ÓĞº£ÉñµÄ»¤Éí·û,ÎÒÊÇ²»»á´ò¿ªÕâÉÈÃÅµÄ!";
		set in_canal_n,1;
		close;
	}
	if (countitem(6436) == 0) {
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÄãÃ»ÓĞ^FF0000º£ÉñµÄ»¤Éí·û^000000(id:6436), ÎÒ²»ÄÜ´ò¿ªÕâÉÈÃÅ!";
		close;
	}
	set .@party_id,getcharid(1);
	set .@md_name$,"ÅÅË®¹µ";
	if (!instance_check_party(.@party_id,2)) {
		mes "^0000ff±ØĞë×é¶Óµ«²»ÏŞÖÆÈËÊı.^000000";
		mes "Òò´Ë¿ìµãÕÙ¼¯×Ô¼ºµÄºÃÓÑ,";
		mes "Ò»Æğ¹ıÀ´Ã°ÏÕ°É.";
		close;
	}
	set .@playtime, checkquest(12254,PLAYTIME);
	if (.@playtime == -1) {
		if (getcharid(0) == getpartyleader(.@party_id,2)) {
			mes "[Çå½à¹¤Ğ¡ÁÖ]";
			mes "àÅ? Ê²Ã´Çé¿ö? Èç¹ûÄãÊÇ¶Ó³¤µÄ»°¾Í¸æËßÎÒ¿ÚÁî!";
			next;
			switch(select("- ²»,ÎÒ²»ÊÇ¶Ó³¤.:- Äã¾¹¸ÒÎêÈèÎÒ.:- ½øÈëÅÅË®Çş¸±±¾.")) {
			case 1:
				mes "[Çå½à¹¤Ğ¡ÁÖ]";
				mes "¾¹È»ÊÇ¸ö²ËÄñ.";
				close;
			case 2:
				set .@instance,instance_create(.@md_name$,.@party_id);
				if (.@instance < 0) {
					mes "¶ÓÎéÃû³Æ: "+getpartyname(.@party_id);
					mes "¶Ó    ³¤: "+strcharinfo(0);
					mes "^0000ff"+.@md_name$+"^000000 - ×¢²áÊ§°Ü!";
					close;
				}
				if (instance_attachmap("1@pump",.@instance) == "" || instance_attachmap("2@pump",.@instance) == "") {
					mes "^0000ff"+.@md_name$+"^000000 - ×¢²áÊ§°Ü!";
					instance_destroy(.@instance);
					close;
				}
				instance_set_timeout 3600,300,.@instance;
				instance_init(.@instance);
				
				mes "^3333FF"+.@md_name$+"^000000 - ×¢²áÖĞ";
				mes "×¢²áÍê³Éºó, Äã¿ÉÒÔÑ¡Ôñ";
				mes "½øÈëÅÅË®¹µ.";
				close;
			case 3:
				callsub L_Enter,0;
			}
		}
		if(select("- ½øÈë¸±±¾:- È¡Ïû") == 2)
			end;
		callsub L_Enter,1;
	} else if (.@playtime == 0 || .@playtime == 1) {
		mes "Èç¹ûÈë¿ÚµÄÃÅ´ò¿ªµÄ»°, Äã¾Í¿ÉÒÔ½øÈë¸±±¾ÁË.";
		next;
		if(select("- ½øÈë¸±±¾:- È¡Ïû") == 2)
			close;
		callsub L_Enter,0;
	} else if (.@playtime == 2) {
		mes "^0000ffÍ¨Ïò¸±±¾µÄ´óÃÅÔÙ´Î´ò¿ª.^000000";
		erasequest 12254;
		close;
	}
	end;
L_Enter:
	if (has_instance("1@pump") == "") {
		if (checkquest(12254,PLAYTIME) == 0 || checkquest(12254,PLAYTIME) == 1) {
			mes "The gate to the Culvert is still closed.";
			mes "You must wait until you are able to enter or find a party leader who can create the instance.";
			close;
		}
		mes "The memorial dungeon Culvert does not exist.";
		mes "The party leader has not reserved entrance to the dungeon yet.";
		close;
	}
	mapannounce "mal_in01", strcharinfo(0)+" of the party "+getpartyname(.@party_id)+" is entering the Culvert.",bc_map,"0x00ff99";
	if (checkquest(12254) == -1) setquest 12254;
	warp "1@pump",63,98;
	end;
}

// Instance: Common Scripts
//============================================================
1@pump,63,100,4	script	Çå½à¹¤Ğ¡ÁÖ#0	545,{
	if (getcharid(0) != getpartyleader(getcharid(1),2)) {
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÎÒÏÖÔÚÕıÔÚºÍÄãÃÇµÄ¶Ó³¤Ëµ»°. ÇëÄãÃÇÄÍĞÄµÈ´ıÒ»»á!";
		close;
	}
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "ÕâÀïÊÇÃàÃàµºÅÅË®Çş, Äã½«ÔÚÕâÀï´ø×ÅÄãµÄ¶ÓÓÑÒ»ÆğÕ½¶·!";
	next;
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "Ê×ÏÈÎÒ»á´ò¿ª´óÃÅ, ÄãÃÇ×öºÃ¿ªÕ½µÄ×¼±¸ÁËÂğ?";
	next;
	switch(select("- ÎÒ·Ç³£Ï²»¶ÄÇ¸öÃæ°üµÄ¿ÚÎ¶.:- ÎÒ¶®ÈçºÎÈ¥Õ½¶·.:- ^ffffff¸øÎÒ×êÊ¯.^000000")) {
	case 1:
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÄÇºÃ°É, ÎÒ¾ÍÈÃÄãÔÚÕâÀïÏñÍù³£Ò»ÑùÇåÀíÅÅË®Çş! ÎÒÏÈÔ¤±¸ÔÚÓÒÉÏ½Ç¿ªÊ¼, Çë¸úÎÒÀ´!";
		next;
		if(select("- µÈµÈ! ÎÒ¸Ä±äÁËÖ÷ÒâÁË!:- ÈçÄãËùÔ¸~") == 1) {
			mes "[Çå½à¹¤Ğ¡ÁÖ]";
			mes "ßÀ? »¹Ã»ºÃ? ×¼±¸ºÃÁËÇë¸æËßÎÒ.";
			close;
		}
		set 'party_id,getcharid(1);
		mapannounce instance_mapname("1@pump"),"Çå½à¹¤Ğ¡ÁÖ: Ïò×Å3µãÖÓµÄ·½Ïò×ß, È»ºóµÈÎÒ»áÔÚ´«ËÍÃÅµÄÁíÒ»¶Ë¸øÄãÏÂÒ»¸öÖ¸Áî",bc_map,"0xff88ff",FW_NORMAL,15;
		disablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#0");
		enablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n");
		close;
	case 2:
		if (BaseLevel < 140) {
			mes "[Çå½à¹¤Ğ¡ÁÖ]";
			mes "àÅ... ÎÒ¾õµÃÄãÊµÁ¦ºÜÈõ! ¸æËßÎÒÕæÏà°É!!";
			close;
		}
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ºÇºÇ? ÄãµÄÕ½¶·¼¼Êõ¸ß³¬? ºÃ°É, ÄÇÃ´, ÓĞ¸öµØ·½, ÎÒ»¹Ã»È¥ÇåÀí¹ı...Äã¾ÍÈ¥ÄÇÀï°É?!";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÎÒ±ØĞë¸æËßÄã, ¾­¹ıÁË³¤ÆÚµÄÉ¨µ´, ÎÒÃÇÒÑ¾­ÇåÀíÁË²»ÉÙµØ·½, Ê£ÓàµÄµØ·½¶¼·Ç³£Î£ÏÕ, µÍÓÚ140¼¶µÄÈËÉõÖÁ²»ÄÜ½øÈë! ÄãÈ·¶¨Äã»¹ÏëÈ¥?";
		next;
		if(select("- µÈµÈ! ÎÒ¸Ä±äÖ÷ÒâÁË!:- µ±È», ¶¼ÍòÊÂ¾ã±¸~") == 1) {
			mes "[Çå½à¹¤Ğ¡ÁÖ]";
			mes "àÅ? ×îºóÈ·ÈÏÒ»´Î.";
			close;
		}
		set 'party_id,getcharid(1);
		mapannounce instance_mapname("1@pump"),"Çå½à¹¤Ğ¡ÁÖ: ÎÒ»áÏÈ½øÈ¥, È»ºóÄã¸ú½ôÎÒ! ÎÒ»á´ò¿ª3µãÖÓ·½ÏòµÄÍ¨µÀ!",bc_map,"0xff88ff",FW_NORMAL,15;
		disablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#0");
		enablenpc instance_npcname("¶´Ñ¨Èë¿Ú#i");
		close;
	case 3:
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÄãĞ¡×ÓÍæÎÒÊÇ²»ÊÇ~!";
		close;
	}
	end;
}

1@pump,84,105,0	script	¶´Ñ¨Èë¿Ú#i	45,3,3,{
	end;
OnInstanceInit:
	disablenpc instance_npcname("¶´Ñ¨Èë¿Ú#i");
	end;
OnTouch:
	if (BaseLevel >= 140)
		warp instance_mapname("2@pump"),38,88;
	else
		warp instance_mapname("1@pump"),74,105;
	end;
}

function	script	F_mal_missing	{
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "ÎÒ»áÖ¸µãÄãÓ¦¸ÃÔõÃ´×ö, ÄãÓĞÃ»¿´µ½ÖÜÎ§µÄÅÅË®Çş?";
	next;
	if(select("- Ê²Ã´ÅÅË®Çş??:- ÊÇµÄ, ÎÒ¿´¼ûÁË.") == 1) {
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "àÅ? ¿´Ñù×ÓÄãÊÇµÚÒ»´ÎÀ´ÕâµØ·½? Äã»á¿´µ½Ò»Ğ©ÂñÔÚÄàÍÁÀïµÄ»úÆ÷. Äã±ØĞëÔÚ¸½½üºÃºÃÕÒÕÒ!";
		close;
	}
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "ºÜºÃ! ÕâĞ©ÅÅË®Çş¶ÔÎÒÃÇ·Ç³£ÖØÒª! Òò´ËÎÒÃÇ±ØĞë×èÖ¹ÄÇĞ©º£ÔåµÄ·±Ö³. ÕâÒ²ÊÇÎÒ, Çå½à¹¤µÄÊ¹Ãü!";
	next;
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "Ğ¡ĞÄ! ÓĞĞ©¾«Ã÷µÄ¹ÖÎï»áÍµÍµ¸ú×ÅÄã! ¾ø¶Ô²»ÄÜÈÄË¡ËüÃÇ!";
	next;
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "»¹ÓĞ... Ç§Íò²»ÄÜÈÃÄÇĞ©ÊÜÎÛÈ¾µÄº£Ôå³¤³öµÚ6¸ö·Ö²í! Ò»¶¨Òª¿ØÖÆÔÚ5ÌõÒÔÏÂ! ·ñÔò, ÎÒ»áÒÔÍæºöÖ°ÊØ×ï°ÑÄã´ÓÕâÀï¶ª³öÈ¥!!";
	next;
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "ÎÒ²»»á½éÒâÄã´Ó×Ô¼ºµÄ¶ÓÓÑÕâÀï»ñµÃ°ïÖú. ÎÒÏ£ÍûÄãÄÜÇåÀíÍêÕû¸ö¶´Ñ¨! ²»ÒªÍü¼Ç! ÎÒÒ²»áÔÚ±ßÉÏ¾¡ÎÒËùÄÜ¸øÄã¸÷ÖÖÌáÊ¾ºÍ½¨Òé. !!";
	next;
	if (getcharid(0) != getpartyleader(getcharid(1),2)) {
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "Ò»µ©ÄãÃÇµÄ¶Ó³¤Íê³É×¼±¸¹¤×÷, ¸±±¾¾Í»á¿ªÊ¼, ËùÒÔÇë´òÆğ¾«ÉñÀ´!!";
		close;
	}
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "ÄÇÃ´, ÄãÏÖÔÚ×¼±¸¾ÍĞ÷ÁËÂğ?";
	next;
	switch(select("+ µÈµÈ! »¹Ã»!:- ÈÃÎÒÃÇ¿ªÊ¼°É!")) {
	case 1:
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "àÅ? »¹Ã»ºÃ? ×¼±¸ºÃÁË¾Í¸æËßÎÒ.";
		close;
	case 2:
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "OK! ºÃÏ·¿ªÊ¼ÁË!";
		return;
	}
}

// Instance: Normal Mode
//============================================================
1@pump,84,105,4	script	Çå½à¹¤Ğ¡ÁÖ#nf	545,{
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "ÎÒÔÚÕâÀï¸ÉÁË40Äê, ÄãÃÇÊÇÎÒ¼û¹ı×î²îµÄ¶ÓÎé!!";
	next;
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "ÄãÃÇµÄÊèºöµ¼ÖÂÕâÀï³¤ÂúÁË±»ÎÛÈ¾µÄº£Ôå! ËùÓĞµÄÅÅË®Çş¶¼ÊÕµ½¶ÂÈûµÄ·çÏÕ!";
	next;
	if (getcharid(0) != getpartyleader(getcharid(1),2)) {
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "µÈÄãÃÇµÄ¶Ó³¤»Ø¹ıÉñÀ´, »á¸æËßÄãÃÇ´¦·£¾ö¶¨. ÏÖÔÚÄãÃÇ¿ÉÒÔ×öÒ»ÏÂË¼Ïë×¼±¸!!";
		close;
	}
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "Èç¹ûÄãÓĞµ¨Á¿ÔÙ´ÎÌôÕ½, ÎÒÔÙ¸øÄãÒ»´Î»ú»á! ÄãµÄÏë·¨ÊÇ!?";
	next;
	switch(select("- µÈµÈ! ÏÖÔÚ²»ĞĞ!:- ºÃµÄ, ÈÃÎÒÃÇÔÙÀ´Ò»´Î!")) {
	case 1:
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "¼Ç×¡µ±¶ÏÔò¶Ï! µÈÄãÃÇ×¼±¸ºÃÁË¾Í¸æËßÎÒ.";
		close;
	case 2:
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ºÃµÄ! ÈÃÎÒÃÇÏÖÔÚ¾Í¿ªÊ¼!";
		set .@i$, charat(strnpcinfo(2),0);
		enablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#"+.@i$);
		donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#"+.@i$)+"::OnStart";
		disablenpc instance_npcname("¶´Ñ¨Èë¿Ú#"+.@i$);
		disablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#"+.@i$+"o");
		donpcevent instance_npcname("¹ÖÎï¶´#"+.@i$)+"::OnClear";
		disablenpc instance_npcname(strnpcinfo(0));
		close;
	}
	close;
OnInstanceInit:
	disablenpc instance_npcname(strnpcinfo(0));
	end;
}

1@pump,84,105,4	script	Çå½à¹¤Ğ¡ÁÖ#n	545,{
	callfunc "F_mal_missing";
	donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnStart";
	close;
OnInstanceInit:
	disablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n");
	end;
OnStart:
	killmonster instance_mapname("1@pump"),instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnMyMobDead";
	disablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n");
	initnpctimer;
	end;
OnAddSeaweed:
	set .@map$, instance_mapname("1@pump");
	areamonster .@map$,55,99,61,105,"ÊÜÎÛÈ¾µÄº£Ôå",2191,1,instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnMyMobDead";
	set .@mob_dead_num, mobcount(.@map$,instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnMyMobDead");
	if (.@mob_dead_num >= 6)
		donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnFail";
	else
		mapannounce .@map$,"ÊÜÎÛÈ¾µÄº£Ôå: "+.@mob_dead_num+" stem",bc_map,"0xff3333",FW_NORMAL,20;
	end;
OnMyMobDead:
	end;
OnFail:
	stopnpctimer;
	donpcevent instance_npcname("¹ÖÎï¶´#n")+"::OnClear";
	set .@map$, instance_mapname("1@pump");
	killmonster .@map$,instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnMyMobDead";
	enablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#nf");
	mapannounce .@map$,"ÄãÃÇ¾¿¾¹ÔÚÕâÀï¸ÉÊ²Ã´!! µ½´¦¶¼ÊÇ¸ÃËÀº£Ôå! ·ÅÆúÄãµÄ¹¤×÷! Àë¿ªÕâÀï!!",bc_map,"0xff88ff",FW_NORMAL,15;
	disablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n");
	end;
OnTimer100:
	mapannounce instance_mapname("1@pump"),"µÚÒ»¸öÅÅË®Çş½«ÔÚ5ÃëÖÓÄÚ¿ªÆô. ÇåÀíÕßÃÇÇëµ½ÅÅË®ÇşÕâÀïµ¥»÷¡°¿ªÊ¼ÇåÀí¡±.",bc_map,"0x00ffcc",FW_NORMAL,15;
	end;
OnTimer5500:
	mapannounce instance_mapname("1@pump"),"ÅÅË®Çş¸±±¾½¨Á¢Ê±, µÈºòµÄÍæ¼ÒÎŞ·¨ÒÆ¶¯ºÍ¹¥»÷.",bc_map,"0x00ffcc",FW_NORMAL,15;
	donpcevent instance_npcname("¹ÖÎï¶´#n")+"::OnSpawn";
	end;
OnTimer45000:
OnTimer95000:
OnTimer145000:
OnTimer195000:
OnTimer245000:
OnTimer295000:
OnTimer345000:
OnTimer395000:
OnTimer445000:
	mapannounce instance_mapname("1@pump"),"ÏÂÒ»¸öÅÅË®Çş½«ÔÚ50ÃëÄÚ¿ªÆô. Çë¾¡¿ìÕÒµ½ÏÂÒ»¸öÅÅË®ÇşµÄÎ»ÖÃ.",bc_map,"0x00ffcc",FW_NORMAL,15;
	end;
OnTimer50000:
OnTimer100000:
OnTimer150000:
	donpcevent instance_npcname("¹ÖÎï¶´#n")+"::OnSpawn";
	end;
OnTimer200000:
OnTimer250000:
OnTimer300000:
OnTimer350000:
OnTimer400000:
OnTimer450000:
	set .@mob_dead_num, mobcount(instance_mapname("1@pump"),instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnMyMobDead");
	if (.@mob_dead_num >= 6)
		donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnFail";
	else
		donpcevent instance_npcname("¹ÖÎï¶´#n")+"::OnSpawn";
	end;
OnTimer515000:
	set .@map$, instance_mapname("1@pump");
	set .@mob_dead_num, mobcount(.@map$,instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnMyMobDead");
	mapannounce .@map$,"ÊÜÎÛÈ¾µÄº£Ôå: "+.@mob_dead_num+" ¾¡¿ìÍê³ÉÇå½à¹¤×÷, Çå½à¹¤Ğ¡ÁÖ¾Í¿ìÀ´¼ì²éÁË.",bc_map,"0xff3333",FW_NORMAL,20;
	end;
OnTimer520000:
	stopnpctimer;
	set .@mob_dead_num, mobcount(instance_mapname("1@pump"),instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnMyMobDead");
	if (.@mob_dead_num >= 6)
		donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnFail";
	else
		donpcevent instance_npcname("Boss Creation#n")+"::OnEnable";
	end;
}

1@pump,1,1,4	script	¹ÖÎï¶´#n	-1,{
	end;
OnSpawn:
	set .@i$, charat(strnpcinfo(2),0);
	if (.@i$ == "n")
		set .@n,6;
	else if (.@i$ == "h")
		set .@n,10;
	donpcevent instance_npcname("#Culvert_"+.@i$+rand(1,.@n))+"::OnEnable";
	end;
OnClear:
	set .@i$, charat(strnpcinfo(2),0);
	if (.@i$ == "n")
		set .@n,6;
	else if (.@i$ == "h")
		set .@n,10;
	for(set .@i,1; .@i<=.@n; set .@i,.@i+1)
		donpcevent instance_npcname("#Culvert_"+.@i$+.@n)+"::OnClear";
	end;
}

1@pump,36,111,4	script	#Culvert_n1	844,14,14,{ //temporary workaround for ALL_SAMEMAP
	progressbar "0xFFFF00",10;
	stopnpctimer;
	disablenpc instance_npcname(strnpcinfo(0));
	end;
OnInstanceInit:
	disablenpc instance_npcname(strnpcinfo(0));
	end;
OnEnable:
	enablenpc instance_npcname(strnpcinfo(0));
	set .@label$, instance_npcname(strnpcinfo(0))+"::OnMyMobDead";
	set .@map$, instance_mapname("1@pump");
	set .@index, atoi(charat(strnpcinfo(2),9));
	switch(.@index) {
		case 1: setarray .@c[0],32,107,40,115; break;
		case 2: setarray .@c[0],64,120,72,128; break;
		case 3: setarray .@c[0],76,110,84,118; break;
		case 4: setarray .@c[0],36,76,44,84; break;
		case 5: setarray .@c[0],71,76,79,84; break;
		case 6: setarray .@c[0],54,97,62,105; break;
	}
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£Ğ·",2176,rand(1,3),.@label$;
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£ÕÂÓã",2175,rand(1,3),.@label$;
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£ó¦Ğ·",2174,rand(1,3),.@label$;
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£¼Ä¾ÓĞ·",2178,rand(1,3),.@label$;
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£¿â¿ËÀ×",2179,rand(1,3),.@label$;
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£Ğ·Öë",2177,rand(1,3),.@label$;
	specialeffect EF_MAPPILLAR2,ALL_SAMEMAP; //currently broken
	getmapxy(.@map$,.@x,.@y,1);
	getpartymember 'party_id,2;
	copyarray .@partymemberaid[0],$@partymemberaid[0],$@partymembercount;
	for(set .@i,0; .@i<$@partymembercount; set .@i,.@i+1) {
		if (attachrid(.@partymemberaid[.@i])) {
			if (strcharinfo(3) == .@map$)
				viewpoint 0,.@x,.@y,.@index,0xFFFF00;
			detachrid;
		}
	}
	initnpctimer;
	end;
OnMyMobDead:
	end;
OnClear:
	stopnpctimer;
	killmonster instance_mapname("1@pump"),instance_npcname(strnpcinfo(0))+"::OnMyMobDead";
	end;
OnTimer49500:	//OnTimer50000 clashes with the timer in "Çå½à¹¤Ğ¡ÁÖ#h".
	donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#n")+"::OnAddSeaweed";
	donpcevent instance_npcname(strnpcinfo(0))+"::OnClear";
	disablenpc instance_npcname(strnpcinfo(0));
	end;
OnTouch:
	specialeffect EF_MAPPILLAR2;
	end;
}
1@pump,68,124,4	duplicate(#Culvert_n1)	#Culvert_n2	844,14,14
1@pump,80,114,4	duplicate(#Culvert_n1)	#Culvert_n3	844,14,14
1@pump,40,80,4	duplicate(#Culvert_n1)	#Culvert_n4	844,14,14
1@pump,75,80,4	duplicate(#Culvert_n1)	#Culvert_n5	844,14,14
1@pump,58,101,4	duplicate(#Culvert_n1)	#Culvert_n6	844,14,14

1@pump,1,1,4	script	Boss Creation#n	-1,{
	end;
OnInstanceInit:
	disablenpc instance_npcname(strnpcinfo(0));
	end;
OnEnable:
	enablenpc instance_npcname(strnpcinfo(0));
	initnpctimer;
	end;
OnTimer100:
	set .@i$, charat(strnpcinfo(2),0);
	if (.@i$ == "n")
		mapannounce instance_mapname("1@pump"),"àÅ! ¸ÉµÄ²»Àµ!",bc_map,"0xff88ff",FW_NORMAL,15;
	else if (.@i$ == "h")
		mapannounce instance_mapname("2@pump"),"àÅ! Ğ¡×ÓÃÇ»¹ĞĞ!!",bc_map,"0xff88ff",FW_NORMAL,15;
	end;
OnTimer5000:
	mapannounce strnpcinfo(4),"ÈÃÎÒÃÇ´ò°ü´ø×ß...Ê²Ã´!!?",bc_map,"0xff88ff",FW_NORMAL,15;
	end;
OnTimer10000:
	mapannounce strnpcinfo(4),"ÎÒ¸Ğ¾õµ½ÁËÒ»Ë¿Î£ÏÕµÄÆøÏ¢! ²»Òª·ÅËÉ - ×¼±¸Õ½¶·!!",bc_map,"0xff88ff",FW_NORMAL,15;
	end;
OnTimer20000:
	stopnpctimer;
	set .@i$, charat(strnpcinfo(2),0);
	set .@label$, instance_npcname(strnpcinfo(0))+"::OnMyMobDead";
	if (rand(1,100) > 50) {
		if (.@i$ == "n")
			monster instance_mapname("1@pump"),0,0,"¹ÖÒìÇ»¼¬Óã",2188,1,.@label$;
		else if (.@i$ == "h")
			monster instance_mapname("2@pump"),0,0,"Í»±äÇ»¼¬Óã",2189,1,.@label$;
		mapannounce strnpcinfo(4),"¶´Ñ¨Éî´¦ÓĞÒ»¸ö¾Ş´óµÄÉúÎï·¢³ö¾ªÈËµÄÉùÏì.",bc_map,"0x00ffcc",FW_NORMAL,15;
	} else {
		if (.@i$ == "n")
			monster instance_mapname("1@pump"),0,0,"ºÚ°µÇ»¼¬Óã",2187,1,.@label$;
		else if (.@i$ == "h")
			monster instance_mapname("2@pump"),0,0,"Ğ×±©Ç»¼¬Óã",2190,1,.@label$;
		mapannounce strnpcinfo(4),"¶´Ñ¨Éî´¦´«À´¾Ş´óµÄÉùÏì.",bc_map,"0x00ffcc",FW_NORMAL,15;
	}
	end;
OnMyMobDead:
	if (mobcount(strnpcinfo(4),instance_npcname(strnpcinfo(0))+"::OnMyMobDead") < 1) {
		mapannounce strnpcinfo(4),"Äã»÷É±ÁË¶´Ñ¨ÖĞËùÓĞµÄ¹ÖÎï. µØÉÏÓĞ½±ÀøÎïÆ·, ÇëÈ¡×ß.",bc_map,"0xffff00",FW_NORMAL,15;
		set .@i$, charat(strnpcinfo(2),0);
		set .@map$, strnpcinfo(4);
		enablenpc instance_npcname("¶´Ñ¨Èë¿Ú#"+.@i$);
		enablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#"+.@i$+"o");
		if (.@i$ == "n") {
			for(set .@i,0; .@i<10; set .@i,.@i+1) {
				set .@j, rand(1,6401);
				     if (.@j < 5001) set .@item,12636; //Malang_Sp_Can
				else if (.@j < 5501) set .@item,12615; //Low_Coin_Pocket
				else if (.@j < 6001) set .@item,12621; //Egrade_Pocket
				else if (.@j < 6201) set .@item,12620; //Dgrade_Pocket
				else if (.@j < 6401) set .@item,12623; //High_Weapon_Box
				else continue;
				makeitem .@item,1,.@map$,rand(40,77),rand(87,120);
			}
		} else if (.@i$ == "h") {
			for(set .@i,0; .@i<10; set .@i,.@i+1) {
				set .@j, rand(1,5001);
				     if (.@j < 2001) set .@item,12615; //Low_Coin_Pocket
				else if (.@j < 3001) set .@item,12621; //Egrade_Pocket
				else if (.@j < 4001) set .@item,12620; //Dgrade_Pocket
				else if (.@j < 4501) set .@item,12619; //Cgrade_Pocket
				else if (.@j < 5001) set .@item,12623; //High_Weapon_Box
				else continue;
				makeitem .@item,1,.@map$,rand(40,77),rand(87,120);
			}
		}
	} else
		mapannounce strnpcinfo(4),"»¹ÓĞ¹ÖÎï»î×Å.",bc_map,"0x00ff99",FW_NORMAL,20;
	end;
}

1@pump,84,105,4	script	Çå½à¹¤Ğ¡ÁÖ#no	545,{
	set .@i$, charat(strnpcinfo(2),0);
	if (.@i$ == "n") {
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÎÒÌ«ÓŞ´ÀÁË!!";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "Õâ¹Å¹ÖµÄÓã, ËÆºõÊÇÒ»ÌõÉú³¤ÔÚÕâÀïµÄÇ»¼¬Óã.ÕâÊÇÎÒµÚÒ»´Î¿´µ½ËüÃÇ¶À×ÔÀ´µ½ÕâÀï!";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÎÒ»áÇåÀíÕâ¸öÊ¬Ìå.´ò°üºóÀë¿ª!Èë¿ÚÎ»ÓÚÁíÒ»²à, ¿ìÈ¥ÕÒ°É!";
		next;
	} else if (.@i$ == "h") {
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "Äã¸ÉµôÁËÒ»¸ö¾Ş´óµÄ¹ÖÎï!";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "Äã¸ÉµôµÄÊÇÒ»ÖÖÇ»¼¬Óã.Ôø¾­Ò²ÓĞÈËÊÔÍ¼¸ÉµôËûÃÇ, µ«Ê§°ÜÁË.";
		next;
		mes "[Çå½à¹¤Ğ¡ÁÖ]";
		mes "ÎÒ»áÇåÀíÊ¬Ìå.Äã´ø×Å½±ÀøÏÈ×ß!";
		next;
	}
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
  mes "»¹ÓĞÒ»¼şÊÂ!²»ÒªºÍÈÎºÎÈËËµÆğÔÚÕâÀï¼ûµ½µÄÇé¿ö!";
	next;
	mes "[Çå½à¹¤Ğ¡ÁÖ]";
	mes "Èç¹ûÍĞÂíË¹°ÑÕâÀï¹ØÁË, ÎÒÃÇ»áÊ§È¥ÎÒÃÇµÄ¹¤×÷!";
	close;
OnInstanceInit:
	disablenpc instance_npcname(strnpcinfo(0));
	end;
}

1@pump,32,100,0	script	¶´Ñ¨Èë¿Ú#n	45,3,3,{
	end;
OnInstanceInit:
	disablenpc instance_npcname(strnpcinfo(0));
	end;
OnTouch:
	warp "mal_in01",161,32;
	end;
}

//MD_Putmob "1@pump" 0 0 0 0 20 º£µÂÀ­ 0 0 2
1@pump,1,1,4	script	º£µÂÀ­#n	-1,{
OnInstanceInit:
	monster strnpcinfo(4),0,0,"º£µÂÀ­",1068,20;
	end;
}

// Instance: Hard Mode
//============================================================
2@pump,39,88,4	duplicate(Çå½à¹¤Ğ¡ÁÖ#nf)	Çå½à¹¤Ğ¡ÁÖ#hf	545

2@pump,39,88,4	script	Çå½à¹¤Ğ¡ÁÖ#h	545,{
	callfunc "F_mal_missing";
	donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnStart";
	close;
OnStart:
	killmonster instance_mapname("2@pump"),instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnMyMobDead";
	disablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h");
	initnpctimer;
	end;
OnAddSeaweed:
	set .@map$, instance_mapname("2@pump");
	areamonster .@map$,75,78,85,88,"ÊÜÎÛÈ¾µÄº£Ôå",2191,1,instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnMyMobDead";
	set .@mob_dead_num, mobcount(.@map$,instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnMyMobDead");
	if (.@mob_dead_num >= 6)
		donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnFail";
	else
		mapannounce .@map$,"ÊÜÎÛÈ¾µÄº£Ôå: "+.@mob_dead_num+"¸öÊÜÎÛÈ¾µÄº£Ôå·Ö²í",bc_map,"0xff3333",FW_NORMAL,20;
	end;
OnMyMobDead:
	end;
OnFail:
	stopnpctimer;
	donpcevent instance_npcname("¹ÖÎï¶´#h")+"::OnClear";
	set .@map$, instance_mapname("2@pump");
	killmonster .@map$, instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnMyMobDead";
	enablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#hf");
	mapannounce .@map$,"ÄãÃÇ¾¿¾¹ÔÚÕâÀï¸ÉÊ²Ã´!! µ½´¦¶¼ÊÇ¸ÃËÀº£Ôå! ·ÅÆúÄãµÄ¹¤×÷! Àë¿ªÕâÀï!!",bc_map,"0xff88ff",FW_NORMAL,15;
	disablenpc instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h");
	end;
OnTimer100:
	mapannounce instance_mapname("2@pump"),"µÚÒ»¸öÅÅË®Çş½«ÔÚ5ÃëÄÚ´ò¿ª. ÇåÀíÕßÃÇ¿ÉÒÔµ½ÅÅË®Çş¶´¿Úµ¥»÷'¿ªÊ¼ÇåÀí'.",bc_map,"0x00ffcc",FW_NORMAL,15;
	end;
OnTimer5500:
	mapannounce instance_mapname("2@pump"),"¸±±¾¹¹½¨¹ı³ÌÖĞ, ËùÓĞ²Î¼Ó¸±±¾µÄÈËÔ±ÎŞ·¨ÒÆ¶¯ºÍ¹¥»÷.",bc_map,"0x00ffcc",FW_NORMAL,15;
	donpcevent instance_npcname("¹ÖÎï¶´#h")+"::OnSpawn";
	end;
OnTimer35000:
OnTimer75000:
OnTimer115000:
OnTimer155000:
OnTimer195000:
OnTimer235000:
OnTimer275000:
OnTimer315000:
OnTimer355000:
	mapannounce instance_mapname("2@pump"),"ÏÂÒ»¸öÅÅË®Çş½«ÔÚ5ÃëÄÚ´ò¿ª. Çë¾¡¿ìµ½´ïÏÂÒ»¸öÅÅË®ÇşµÄÎ»ÖÃ.",bc_map,"0x00ffcc",FW_NORMAL,15;
	end;
OnTimer40000:
OnTimer80000:
OnTimer120000:
	donpcevent instance_npcname("¹ÖÎï¶´#h")+"::OnSpawn";
	end;
OnTimer160000:
OnTimer200000:
OnTimer240000:
OnTimer280000:
OnTimer320000:
OnTimer360000:
	set .@mob_dead_num, mobcount(instance_mapname("2@pump"),instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnMyMobDead");
	if (.@mob_dead_num >= 6)
		donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnFail";
	else
		donpcevent instance_npcname("¹ÖÎï¶´#h")+"::OnSpawn";
	end;
OnTimer420000:
	mapannounce instance_mapname("2@pump"),"¿´Ñù×Ó, Çå½à¹¤Ğ¡ÁÖÂíÉÏ¾ÍÒªÀ´¼ì²éÎÒÃÇµÄÇåÀíÇé¿öÁË. ÎÒÃÇÄÜ°ÑÕâÀïµÄÀÃÌ¯×ÓÇåÀí¸É¾»Ã´?",bc_map,"0xff3333",FW_NORMAL,20;
	end;
OnTimer425000:
	stopnpctimer;
	set .@mob_dead_num, mobcount(instance_mapname("2@pump"),instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnMyMobDead");
	if (.@mob_dead_num >= 6)
		donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnFail";
	else
		donpcevent instance_npcname("Boss Creation#h")+"::OnEnable";
	end;
}

2@pump,53,114,4	script	#Culvert_h1	844,14,14,{ //temporary workaround for ALL_SAMEMAP
	progressbar "0xFFFF00",15;
	stopnpctimer;
	disablenpc instance_npcname(strnpcinfo(0));
	end;
OnInstanceInit:
	disablenpc instance_npcname(strnpcinfo(0));
	end;
OnEnable:
	enablenpc instance_npcname(strnpcinfo(0));
	set .@label$, instance_npcname(strnpcinfo(0))+"::OnMyMobDead";
	set .@map$, instance_mapname("2@pump");
	set .@index, atoi(substr(strnpcinfo(2),9,getstrlen(strnpcinfo(2))-1));
	switch(.@index) {
		case 1: setarray .@c[0],49,110,57,118; break;
		case 2: setarray .@c[0],75,105,83,113; break;
		case 3: setarray .@c[0],110,110,118,118; break;
		case 4: setarray .@c[0],94,94,102,102; break;
		case 5: setarray .@c[0],58,92,66,100; break;
		case 6: setarray .@c[0],53,66,61,74; break;
		case 7: setarray .@c[0],43,45,51,53; break;
		case 8: setarray .@c[0],77,59,85,67; break;
		case 9: setarray .@c[0],96,70,104,78; break;
		case 10: setarray .@c[0],111,46,119,54; break;
	}
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£º£Âí",2182,rand(2,3),.@label$;
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£½£Óã",2181,rand(2,3),.@label$;
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£º£Éñ",2180,rand(2,3),.@label$;
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£öùÓã",2183,rand(2,3),.@label$;
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº£ÈËÓã",2184,rand(2,3),.@label$;
	areamonster .@map$,.@c[0],.@c[1],.@c[2],.@c[3],"Éîº?¨·¨",2185,rand(2,3),.@label$;
	specialeffect EF_MAPPILLAR2,ALL_SAMEMAP; //currently broken
	initnpctimer;
	end;
OnMyMobDead:
	end;
OnClear:
	stopnpctimer;
	killmonster instance_mapname("2@pump"),instance_npcname(strnpcinfo(0))+"::OnMyMobDead";
	end;
OnTimer39500:	//OnTimer40000 clashes with the timer in "Çå½à¹¤Ğ¡ÁÖ#h".
	donpcevent instance_npcname("Çå½à¹¤Ğ¡ÁÖ#h")+"::OnAddSeaweed";
	donpcevent instance_npcname(strnpcinfo(0))+"::OnClear";
	disablenpc instance_npcname(strnpcinfo(0));
	end;
OnTouch:
	specialeffect EF_MAPPILLAR2;
	end;
}
2@pump,79,109,4	duplicate(#Culvert_h1)	#Culvert_h2	844,14,14
2@pump,114,114,4	duplicate(#Culvert_h1)	#Culvert_h3	844,14,14
2@pump,98,98,4	duplicate(#Culvert_h1)	#Culvert_h4	844,14,14
2@pump,62,96,4	duplicate(#Culvert_h1)	#Culvert_h5	844,14,14
2@pump,57,70,4	duplicate(#Culvert_h1)	#Culvert_h6	844,14,14
2@pump,47,49,4	duplicate(#Culvert_h1)	#Culvert_h7	844,14,14
2@pump,81,63,4	duplicate(#Culvert_h1)	#Culvert_h8	844,14,14
2@pump,100,74,4	duplicate(#Culvert_h1)	#Culvert_h9	844,14,14
2@pump,115,50,4	duplicate(#Culvert_h1)	#Culvert_h10	844,14,14

2@pump,1,1,4	duplicate(¹ÖÎï¶´#n)	¹ÖÎï¶´#h	-1
2@pump,1,1,4	duplicate(Boss Creation#n)	Boss Creation#h	-1
2@pump,39,88,4	duplicate(Çå½à¹¤Ğ¡ÁÖ#no)	Çå½à¹¤Ğ¡ÁÖ#ho	545
2@pump,38,100,0	duplicate(¶´Ñ¨Èë¿Ú#n)	¶´Ñ¨Èë¿Ú#h	45,3,3

//MD_Putmob "2@pump" 0 0 0 0 20 º£µÂÀ­ 0 0 2
2@pump,1,1,4	duplicate(º£µÂÀ­#n)	º£µÂÀ­#h	-1
